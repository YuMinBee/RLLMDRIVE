# RLLMDRIVE - Vision-Language Model for Autonomous Driving

μμ¨μ£Όν–‰μ„ μ„ν• Vision-Language λ©€ν‹°λ¨λ‹¬ λ¨λΈ ν”„λ΅μ νΈ

## π“‹ ν”„λ΅μ νΈ κ°μ”

Carla μ‹λ®¬λ μ΄ν„°μ λΉ„μ „ μ •λ³΄λ¥Ό LLMμ΄ μ΄ν•΄ν•  μ μλ„λ΅ ν† ν°ν™”ν•μ—¬, μμ¨μ£Όν–‰ μμ‚¬κ²°μ •μ— ν™μ©ν•λ” Vision-Language λ¨λΈ κ°λ°

## π― λ©ν‘

- Carla μ‹λ®¬λ μ΄μ… μ΄λ―Έμ§€ β†’ ν…μ¤νΈ μ„¤λ… λ³€ν™
- λ„λ΅ μƒν™©, μ¥μ• λ¬Ό, λ‚ μ”¨ λ“± μ¥λ©΄ μ΄ν•΄
- κ°•ν™”ν•™μµκ³Ό μ—°λ™ κ°€λ¥ν• κµ¬μ΅°ν™”λ μ¶λ ¥

## π› οΈ κ°λ° ν™κ²½

### Python & ν¨ν‚¤μ§€
- **Python**: 3.8.10 (Carla, ROS νΈν™μ„±)
- **PyTorch**: 1.12.1+cu116 (CUDA 11.6)
- **Transformers**: 4.46.3
- **κ°€μƒν™κ²½**: venv (`/venv/`)

### μ£Όμ” λΌμ΄λΈλ¬λ¦¬
```
torch==1.12.1
torchvision==0.13.1
transformers==4.46.3
pillow==10.4.0
accelerate==1.0.1
```

## π“‚ ν”„λ΅μ νΈ κµ¬μ΅°

```
RLLMDRIVE/
β”β”€β”€ blip2_model.py          # BLIP-2 Vision-Language λ¨λΈ (λ©”μΈ)
β”β”€β”€ vision_llm_model.py     # CLIP + GPT-2 μ»¤μ¤ν…€ λ¨λΈ (μ‹¤ν—μ©)
β”β”€β”€ test_vision_llm.py      # λ”λ―Έ μ΄λ―Έμ§€ ν…μ¤νΈ
β”β”€β”€ test_carla_image.py     # Carla μ΄λ―Έμ§€ ν…μ¤νΈ
β”β”€β”€ main.py                 # λ©”μΈ μ§„μ…μ  (ν–¥ν›„ μ‚¬μ©)
β”β”€β”€ requirements.txt        # ν¨ν‚¤μ§€ μμ΅΄μ„±
β”β”€β”€ git_push.sh            # Git μλ™ ν‘Έμ‹ μ¤ν¬λ¦½νΈ
β””β”€β”€ README.md              # ν”„λ΅μ νΈ λ¬Έμ„
```

## π€ μ§„ν–‰ μƒν™©

### β… μ™„λ£λ μ‘μ—…

1. **κ°λ° ν™κ²½ κµ¬μ¶•**
   - Python 3.8 κ°€μƒν™κ²½ μƒμ„±
   - PyTorch 1.12.1 μ„¤μΉ (Python 3.8 νΈν™)
   - μμ΅΄μ„± λ¬Έμ  ν•΄κ²° (sympy, typing-extensions λ“±)

2. **λ¨λΈ κµ¬ν„**
   - **CLIP + GPT-2 μ»¤μ¤ν…€ λ¨λΈ** (`vision_llm_model.py`)
     - Vision Encoder: CLIP ViT-Base
     - Projector: 2-layer MLP (CLIP β†’ GPT-2 μ°¨μ› λ³€ν™)
     - LLM: GPT-2
     - κµ¬μ΅° μ΄ν•΄μ©, Projector λ―Έν•™μµ μƒνƒ
   
   - **BLIP-2 λ¨λΈ** (`blip2_model.py`) β­ **ν„μ¬ λ©”μΈ**
     - μ‚¬μ „ ν•™μµλ Vision-Language λ¨λΈ
     - Salesforce/blip2-opt-2.7b (~10GB)
     - μ‹¤μ  μ΄λ―Έμ§€ μ΄ν•΄ κ°€λ¥
     - GPU μλ™ κ°μ§€ (CUDA/CPU)

3. **ν…μ¤νΈ ν™κ²½**
   - λ”λ―Έ μ΄λ―Έμ§€ μƒμ„± λ° ν…μ¤νΈ
   - Carla μ΄λ―Έμ§€ ν…μ¤νΈ μ¤ν¬λ¦½νΈ
   - λ‹¤μ–‘ν• ν”„λ΅¬ν”„νΈ μ‹¤ν— μ¤€λΉ„

4. **Git λ²„μ „ κ΄€λ¦¬**
   - GitHub μ €μ¥μ† μ—°λ™ μ™„λ£
   - μλ™ ν‘Έμ‹ μ¤ν¬λ¦½νΈ (`./git_push.sh`)

### π”„ μ§„ν–‰ μ¤‘

- **LLaVA-7B λ¨λΈ λ‹¤μ΄λ΅λ“ μ™„λ£** (~13GB)
- Carla μ΄λ―Έμ§€ ν…μ¤νΈ μ™„λ£

### π” λ°κ²¬λ λ¬Έμ μ  (2025.11.08)

#### 1. ν™κ²½ μΈμ‹ μ¤λ¥
- **λ¬Έμ **: λ°μ€ ν¬μ¥λ„λ΅λ¥Ό λ λ®μΈ λ„λ΅λ΅ μ¤μΈμ‹
  - μ‹¤μ : λ§‘μ€ λ‚ μ”¨, ν–‡λΉ›μ΄ κ°•ν• μƒν™©
  - λ¨λΈ νλ‹¨: "The road is covered in snow"
- **μ›μΈ**: LLaVA ν•™μµ λ°μ΄ν„°μ—μ„ λ°μ€ λ„λ΅ β†’ λμΌλ΅ ν•™μµλ νΈν–¥
- **μν–¥**: λ‚ μ”¨/λ„λ΅ μƒνƒ νλ‹¨ λ¶€μ •ν™• β†’ μμ¨μ£Όν–‰ μμ‚¬κ²°μ • μ¤λ¥ κ°€λ¥

#### 2. μ£Όν–‰ λ°©ν–¥ νλ‹¨ μ¤λ¥
- **λ¬Έμ **: μ°νμ „ λ¶κ°€λ¥ν• λ„λ΅μ—μ„ μ°νμ „ μ¶”μ²
  - μ‹¤μ : μ§μ§„, μΆνμ „λ§ κ°€λ¥
  - λ¨λΈ νλ‹¨: "I would recommend turning right"
- **μ›μΈ**: Carla λ„λ΅ κµ¬μ΅° νΉμ„± ν•™μµ λ¶€μ΅±
- **μν–¥**: **μ„ν—ν• μ£Όν–‰ νλ‹¨** - μ‹¤μ  μμ¨μ£Όν–‰ μ μ© μ‹ μ‚¬κ³  μ„ν—

#### 3. κΈ°νƒ€ λ°κ²¬ μ‚¬ν•­
- β… μ°¨λ‰/κ±΄λ¬Ό κ°μ§€λ” λΉ„κµμ  μ •ν™•
- β… μΌλ°μ μΈ μ¥λ©΄ μ„¤λ…μ€ ν•©λ¦¬μ 
- β Carla νΉν™” μ •λ³΄(λ„λ΅ ν‘μ§€, μ°¨μ„ , κ°€λ¥ν• ν–‰λ™) μΈμ‹ λ¶€μ΅±
- β λ©μ μ§€ μ •λ³΄ μ—†μ΄λ„ "λ°©ν–¥ μ¶”μ²" - κ·Όκ±° λ¶λ…ν™•

### π“ ν…μ¤νΈ κ²°κ³Ό μ”μ•½

**ν…μ¤νΈ μ΄λ―Έμ§€**: Carla μ‹λ®¬λ μ΄μ… μ¤ν¬λ¦°μƒ· (test1.png)
- μ‹¤μ  μƒν™©: λ§‘μ€ λ‚ μ”¨, κµμ°¨λ΅, μ§μ§„/μΆνμ „ κ°€λ¥
- λ¨λΈ μΈμ‹: λ λ®μΈ λ„λ΅, μ°νμ „ μ¶”μ²

**μ§λ¬Έ-μ‘λ‹µ μ •ν™•λ„**:
| μ§λ¬Έ | μ •ν™•λ„ | λΉ„κ³  |
|------|--------|------|
| λ‚ μ”¨ μ΅°κ±΄ | β λ¶€μ •ν™• | λμΌλ΅ μ¤μΈμ‹ |
| λ„λ΅ ν‘λ©΄/μ„ν—μ”μ† | β λ¶€μ •ν™• | λ κ΄€λ ¨ μ„¤λ… |
| μ°¨λ‰ κ°μ§€ | β… μ •ν™• | νΈλ­, μ£Όμ°¨ μ°¨λ‰ μΈμ‹ |
| κ±΄λ¬Ό/κµ¬μ΅°λ¬Ό | β… λ³΄ν†µ | μΌλ°μ  μ„¤λ… |
| μ£Όμμ‚¬ν•­ | β οΈ λ¶€λ¶„μ  | λκΈΈ μ „μ ν•μ— μ„¤λ… |
| μ£Όν–‰ λ°©ν–¥ | β **μ„ν—** | λ¶κ°€λ¥ν• μ°νμ „ μ¶”μ² |

### π― κ°μ„  λ°©ν–¥

#### λ‹¨κΈ° (μ¦‰μ‹ κ°€λ¥)
1. **ν”„λ΅¬ν”„νΈ μ—”μ§€λ‹μ–΄λ§**
   - λ” λ…ν™•ν• μ§λ¬ΈμΌλ΅ μ •ν™•λ„ ν–¥μƒ
   - Few-shot μμ‹ μ κ³µ
   - μ μ•½ μ΅°κ±΄ λ…μ‹ ("λ¬Όλ¦¬μ μΌλ΅ κ°€λ¥ν• λ°©ν–¥λ§")

2. **κ²½κ³  λ©”μ‹μ§€ ν•΄κ²°**
   - β… processor μ„¤μ • μ¶”κ°€ (patch_size, vision_feature_select_strategy)
   - β οΈ do_sample νλΌλ―Έν„° μ΅°μ • ν•„μ”

#### μ¤‘κΈ° (λ°μ΄ν„° μ¤€λΉ„ ν›„)
3. **νμΈνλ‹ (Fine-tuning)**
   - Carla μ΄λ―Έμ§€ + μ •ν™•ν• λΌλ²¨ λ°μ΄ν„°μ…‹ κµ¬μ¶•
   - LoRA/QLoRAλ΅ ν¨μ¨μ  ν•™μµ
   - λ©ν‘: Carla νΉν™” ν™κ²½ μΈμ‹ λ¥λ ¥ ν–¥μƒ

4. **μ¶λ ¥ κµ¬μ΅°ν™”**
   - JSON ν•μ‹ κ°•μ 
   - κ°€λ¥/λ¶κ°€λ¥ ν–‰λ™ λ…μ‹
   - μ‹ λΆ°λ„ μ μ μ¶”κ°€

#### μ¥κΈ° (ν€ ν‘μ—…)
5. **κ°•ν™”ν•™μµ μ—°λ™**
   - κµ¬μ΅°ν™”λ μ¶λ ¥ β†’ RL μ—μ΄μ „νΈ μ…λ ¥
   - λ³΄μƒ ν•¨μμ™€ μ—°κ³„
   
6. **ROS ν†µν•©**
   - μ‹¤μ‹κ°„ μ΄λ―Έμ§€ μ²λ¦¬
   - μ£Όν–‰ λ…λ Ή μƒμ„±

### π’΅ ν•µμ‹¬ μΈμ‚¬μ΄νΈ

> **μ‚¬μ „ ν•™μµλ Vision-Language λ¨λΈ(LLaVA)λ„ Carla ν™κ²½μ—μ„λ” ν™κ²½ μΈμ‹μ΄ λ¶€μ •ν™•ν•¨**
> 
> - μΌλ° μ΄λ―Έμ§€ μ΄ν•΄ λ¥λ ¥ β‰  μμ¨μ£Όν–‰ νΉν™” μ΄ν•΄
> - **νμΈνλ‹ ν•„μ**: Carla λ°μ΄ν„°λ΅ μ¬ν•™μµ μ—†μ΄λ” μ‹¤μ© λ¶κ°€
> - ν”„λ΅¬ν”„νΈλ§μΌλ΅λ” ν•κ³„ λ…ν™•
> - μ•μ „μ„± critical: μλ»λ νλ‹¨μ΄ μ‚¬κ³ λ΅ μ§κ²°

### π”¬ μ—°κµ¬ μ§„ν–‰ κ³„ν

1. **ν„μ¬ λ‹¨κ³„**: λ² μ΄μ¤λΌμΈ λ¨λΈ ν…μ¤νΈ λ° λ¬Έμ  νμ•… β…
2. **λ‹¤μ λ‹¨κ³„**: 
   - [ ] λ‹¤μ–‘ν• Carla μ‹λ‚λ¦¬μ¤ ν…μ¤νΈ (10+ μ΄λ―Έμ§€)
   - [ ] ν”„λ΅¬ν”„νΈ μµμ ν™” μ‹¤ν—
   - [ ] λ°μ΄ν„°μ…‹ μμ§‘ νμ΄ν”„λΌμΈ κµ¬μ¶•
3. **ν–¥ν›„ λ‹¨κ³„**:
   - [ ] νμΈνλ‹ μ‹¤ν—
   - [ ] μ •λ‰μ  ν‰κ°€ μ§€ν‘ μ •μ
   - [ ] μ„±λ¥ λΉ„κµ λ¶„μ„

### π“ λ‹¤μ λ‹¨κ³„

1. **μ¦‰μ‹ μ‹¤ν–‰ κ°€λ¥**
   - [ ] BLIP-2 λ¨λΈ ν…μ¤νΈ (Carla μ΄λ―Έμ§€)
   - [ ] Zero-shot ν”„λ΅¬ν”„νΈ μµμ ν™”
   - [ ] λ‹¤μ–‘ν• μ£Όν–‰ μ‹λ‚λ¦¬μ¤ ν…μ¤νΈ

2. **λ‹¨κΈ° λ©ν‘**
   - [ ] λ¨λΈ κµ¬μ΅° μ§μ ‘ μμ •
     - Vision Encoder κµμ²΄ μ‹¤ν—
     - Q-Former μ»¤μ¤ν„°λ§μ΄μ§•
     - Projector λ μ΄μ–΄ μ¶”κ°€
   
3. **μ¤‘κΈ° λ©ν‘**
   - [ ] νμΈνλ‹ μ¤€λΉ„
     - κ³µκ° μμ¨μ£Όν–‰ λ°μ΄ν„°μ…‹ μ‹¤ν— (BDD100K, KITTI)
     - LoRA/PEFT ν™κ²½ κµ¬μ¶•
     - Carla λ°μ΄ν„° μμ§‘ νμ΄ν”„λΌμΈ
   - [ ] λ¨λΈ νμΈνλ‹ (Carla νΉν™”)

4. **μ¥κΈ° λ©ν‘**
   - [ ] μ¶λ ¥ κµ¬μ΅°ν™” (ν€μ›κ³Ό ν‘μ)
   - [ ] κ°•ν™”ν•™μµ μ—μ΄μ „νΈ μ—°λ™
   - [ ] ROS ν†µν•©

## π® μ‚¬μ© λ°©λ²•

### μ„¤μΉ
```bash
# κ°€μƒν™κ²½ ν™μ„±ν™”
source venv/bin/activate

# ν¨ν‚¤μ§€ μ„¤μΉ
pip install -r requirements.txt --extra-index-url https://download.pytorch.org/whl/cu116
```

### μ‹¤ν–‰
```bash
# BLIP-2 λ¨λΈ ν…μ¤νΈ (Carla μ΄λ―Έμ§€)
python test_carla_image.py

# λ”λ―Έ μ΄λ―Έμ§€ ν…μ¤νΈ
python test_vision_llm.py

# BLIP-2 λ¨λΈ μ§μ ‘ μ‚¬μ©
python blip2_model.py
```

### Git ν‘Έμ‹
```bash
# λ³€κ²½μ‚¬ν•­ μλ™ μ»¤λ°‹ & ν‘Έμ‹
./git_push.sh "μ»¤λ°‹ λ©”μ‹μ§€"
```

## π“ λ¨λΈ λΉ„κµ

| λ¨λΈ | ν¬κΈ° | μƒνƒ | μ©λ„ | λΉ„κ³  |
|------|------|------|------|------|
| CLIP + GPT-2 | ~650MB | Projector λ―Έν•™μµ | κµ¬μ΅° ν•™μµμ© | μ‹¤ν—μ© |
| ~~BLIP-2 (opt-2.7b)~~ | ~~10GB~~ | ~~μ‚­μ ~~ | - | LLaVAλ΅ λ€μ²΄ |
| **LLaVA-7B** | ~13GB | **μ‚¬μ „ ν•™μµ μ™„λ£** | **λ©”μΈ λ¨λΈ** | Carla ν™κ²½ λ¶€μ •ν™• |

## π”§ κΈ°μ  μ¤νƒ

- **Vision Encoder**: CLIP ViT / BLIP-2 ViT-L
- **Language Model**: GPT-2 / OPT-2.7B
- **Framework**: PyTorch, Transformers
- **Simulation**: Carla (μμ •)
- **Integration**: ROS (μμ •)

## π’΅ ν•µμ‹¬ μ•„μ΄λ””μ–΄

1. **κ²½λ‰ν™” μ°μ„ **: Python 3.8 νΈν™, μµμ† μμ΅΄μ„±
2. **λ¨λ“ν™”**: Vision/Language μ»΄ν¬λ„νΈ λ¶„λ¦¬
3. **μ μ§„μ  κ°μ„ **: 
   - Zero-shot β†’ Prompt Engineering β†’ Fine-tuning
4. **μ‹¤ν— μ¤‘μ‹¬**: κµ¬μ΅° μμ • λ° λ‹¤μ–‘ν• μ‹λ„

## π› ν•΄κ²°λ λ¬Έμ 

### Python λ²„μ „ μ¶©λ
- **λ¬Έμ **: μµμ‹  PyTorch(2.4.1)μ μμ΅΄μ„±μ΄ Python 3.9+ μ”κµ¬
- **ν•΄κ²°**: PyTorch 1.12.1λ΅ λ‹¤μ΄κ·Έλ μ΄λ“ (Python 3.8 νΈν™)
- **κµν›**: Carla/ROS ν™κ²½μ—μ„λ” ν¨ν‚¤μ§€ λ²„μ „ νΈν™μ„± μ¤‘μ”

### μμ΅΄μ„± λ¬Έμ 
- sympy, typing-extensions, filelock λ“± λ²„μ „ μ¶©λ
- PyTorch λ²„μ „ μ΅°μ •μΌλ΅ μΌκ΄„ ν•΄κ²°

## π“ μ°Έκ³  μλ£

- [BLIP-2 λ…Όλ¬Έ](https://arxiv.org/abs/2301.12597)
- [Hugging Face BLIP-2](https://huggingface.co/docs/transformers/model_doc/blip-2)
- [Carla μ‹λ®¬λ μ΄ν„°](https://carla.org/)

## π‘¥ ν‘μ—…

- μ¶λ ¥ κµ¬μ΅°ν™”: ν€μ›κ³Ό μΈν„°νμ΄μ¤ ν‘μ ν•„μ”
- κ°•ν™”ν•™μµ μ—°λ™: μ¶”ν›„ ν†µν•© μμ •

## π“ λ©”λ¨

- BLIP-2 λ¨λΈ λ‹¤μ΄λ΅λ“ μ‹κ°„: μΈν„°λ„· μ†λ„μ— λ”°λΌ 15λ¶„-1μ‹κ°„
- GPU λ©”λ¨λ¦¬: μµμ† 8GB κ¶μ¥ (float16 μ‚¬μ©)
- CPU λ¨λ“λ„ μ§€μ›ν•μ§€λ§ λλ¦Ό

---

**Last Updated**: 2025λ…„ 11μ›” 8μΌ  
**Status**: π΅ κ°λ° μ§„ν–‰ μ¤‘
